#!/usr/bin/env bash
# Copyright (c) 2021 The Toltec Contributors
# SPDX-License-Identifier: MIT

pkgnames=(koreader)
pkgdesc="Ebook reader supporting PDF, DjVu, EPUB, FB2 and many more formats"
url=https://github.com/koreader/koreader
pkgver=2021.03-1
timestamp=2021-02-19T19:49:35Z
section="readers"
maintainer="raisjn <of.raisjn@gmail.com>"
license=AGPL-3.0-or-later
installdepends=(fbink fbdepth display rm2fb-client)

_srcver="v${pkgver%-*}"
source=(
    "https://build.koreader.rocks/download/stable/$_srcver/koreader-remarkable-$_srcver.zip"
    koreader.draft
    KOReader.oxide
    koreader
)
sha256sums=(
    5120f0c9fc6c7f7f1f53a5f3b5b2aa29b63517ee3e9dc6f8d06f162db8b52501
    SKIP
    SKIP
    SKIP
)

package() {
    install -d "$pkgdir"/opt/koreader
    cp -R "$srcdir"/* "$pkgdir"/opt/koreader/
    rm "$pkgdir"/opt/koreader/koreader*zip
    rm "$pkgdir"/opt/koreader/{fbink,fbdepth}
    ln -s /opt/bin/fbink "$pkgdir"/opt/koreader/fbink
    ln -s /opt/bin/fbdepth "$pkgdir"/opt/koreader/fbdepth

    install -D -m 644 -t "$pkgdir"/opt/etc/draft/ "$srcdir"/koreader.draft
    install -D -m 644 -t "$pkgdir"/opt/usr/share/applications/ "$srcdir"/KOReader.oxide
    install -D -m 644 -t "$pkgdir"/opt/etc/draft/icons/ "$srcdir"/resources/koreader.png
    install -D -m 755 -t "$pkgdir"/opt/bin/ "$srcdir"/koreader
}
