#!/usr/bin/env bash
# Copyright (c) 2021 The Toltec Contributors
# SPDX-License-Identifier: MIT

pkgnames=(calculator)
pkgdesc="Touch-based calculator"
url=https://github.com/reHackable/Calculator
pkgver=0.0.0-14
timestamp=2020-08-20T12:28Z
section="math"
maintainer="Matt√©o Delabre <spam@delab.re>"
license=GPL-3.0-or-later
installdepends=(display rm2fb-shim)
makedepends=(build:imagemagick build:librsvg2-bin build:patchelf)
flags=(nostrip)

image=qt:v1.4
source=(
    https://github.com/reHackable/Calculator/archive/7b8be5de12f1536bc04b6216abbf26f998097bf4.zip
    calculator.draft
    calculator.svg
)
sha256sums=(
    02116d385983f6c816374eb6d8b67e53a4a9650e42b0733ab2e145e8dcf87557
    SKIP
    SKIP
)

build() {
    qmake Calculator.pro
    make

    # Inject rm2fb shim after running strip, otherwise strip removes
    # too much information
    "${CROSS_COMPILE}strip" --strip-all Calculator
    patchelf --add-needed librm2fb_client.so Calculator

    convert +set date:create +set date:modify calculator.{svg,png}
}

package() {
    install -D -m 755 "$srcdir"/Calculator "$pkgdir"/opt/bin/calculator
    install -D -m 644 -t "$pkgdir"/opt/etc/draft "$srcdir"/calculator.draft
    install -D -m 644 -t "$pkgdir"/opt/etc/draft/icons "$srcdir"/calculator.png
}
