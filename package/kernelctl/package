#!/usr/bin/env bash
# Copyright (c) 2021 The Toltec Contributors
# SPDX-License-Identifier: MIT

pkgnames=(kernelctl)
pkgdesc="Manage aftermarket kernels"
url=https://toltec-dev.org/
pkgver=0.1-5
timestamp=2022-11-12T00:00Z
section="utils"
maintainer="Salvatore Stella <etn45p4m@gmail.com>"
license=MIT

source=(
    kernelctl
)
sha256sums=(
    SKIP
)

package() {
    touch "$srcdir"/emptyfile
    install -D -m 744 -t "$pkgdir"/opt/bin "$srcdir"/kernelctl
    install -d "$pkgdir"/opt/usr/share/kernelctl
    install -D -m 666 -t "$pkgdir"/usr/share/toltec/reenable.d/kernelctl "$srcdir"/emptyfile
}

configure() {
    if [[ "$(kernelctl list | tail -n +2 | awk '{print $2}' | grep "vanilla-$(< /etc/version)")" == "" ]]; then
        echo "Creating a backup of the currently running kernel."
        kernelctl backup vanilla
    fi
}
